<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUANT SUPERIOR - Live Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #00d4ff;
            padding-bottom: 20px;
        }
        
        header h1 {
            font-size: 2.5em;
            color: #00d4ff;
            text-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
            margin-bottom: 5px;
        }
        
        .status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 5px;
            background: #00aa00;
            font-weight: bold;
            margin-top: 10px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .metric-card:hover {
            border-color: #00d4ff;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
            transform: translateY(-5px);
        }
        
        .metric-label {
            font-size: 0.9em;
            color: #aaa;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 10px;
        }
        
        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff00;
            font-family: 'Courier New', monospace;
        }
        
        .metric-value.negative {
            color: #ff3333;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .chart-title {
            color: #00d4ff;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.2em;
        }
        
        .trades-history {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: rgba(0, 212, 255, 0.2);
            padding: 12px;
            text-align: left;
            border-bottom: 2px solid #00d4ff;
            color: #00d4ff;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }
        
        tr:hover {
            background: rgba(0, 212, 255, 0.1);
        }
        
        .win {
            color: #00ff00;
            font-weight: bold;
        }
        
        .loss {
            color: #ff3333;
            font-weight: bold;
        }
        
        .last-update {
            text-align: center;
            color: #aaa;
            font-size: 0.9em;
            margin-top: 20px;
            padding: 10px;
            border-top: 1px solid rgba(0, 212, 255, 0.2);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #00d4ff;
            font-size: 1.2em;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>âš¡ QUANT SUPERIOR</h1>
            <p>FTSEMIB Overnight Pattern Strategy</p>
            <div class="status">LIVE</div>
        </header>
        
        <div id="content">
            <div class="loading">Caricamento dati...</div>
        </div>
    </div>
    
    <script>
        const DATA_URL = 'data/metrics.json';
        let equityChart = null;
        let drawdownChart = null;
        
        async function loadDashboard() {
            try {
                const response = await fetch(DATA_URL + '?t=' + Date.now());
                const data = await response.json();
                renderDashboard(data);
            } catch (error) {
                console.error('Errore caricamento dati:', error);
                document.getElementById('content').innerHTML = '<div class="loading" style="color: #ff3333;">Errore: impossibile caricare i dati</div>';
            }
        }
        
        function renderDashboard(data) {
            const perf = data.performance;
            const html = `
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-label">Trades Totali</div>
                        <div class="metric-value">${perf.total_trades}</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Win Rate</div>
                        <div class="metric-value">${perf.win_rate.toFixed(2)}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">CAGR</div>
                        <div class="metric-value">${perf.cagr.toFixed(2)}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Max Drawdown</div>
                        <div class="metric-value negative">${perf.max_drawdown.toFixed(2)}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Avg Trade</div>
                        <div class="metric-value" style="color: ${perf.avg_trade >= 0 ? '#00ff00' : '#ff3333'}">${perf.avg_trade.toFixed(3)}%</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Segnale Oggi</div>
                        <div class="metric-value" style="color: ${data.last_signal === 'LONG' ? '#00ff00' : '#ffaa00'}">${data.last_signal}</div>
                    </div>
                </div>
                
                <div class="charts-grid">
                    <div class="chart-container">
                        <div class="chart-title">ðŸ“ˆ Equity Curve</div>
                        <canvas id="equityCanvas"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">ðŸ“‰ Drawdown</div>
                        <canvas id="drawdownCanvas"></canvas>
                    </div>
                </div>
                
                <div class="trades-history">
                    <div class="chart-title">ðŸ“‹ Ultime Trades</div>
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>PnL %</th>
                                <th>Risultato</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.trades_history.map(t => `
                                <tr>
                                    <td>${t.date}</td>
                                    <td>${t.entry.toFixed(2)}</td>
                                    <td>${t.exit.toFixed(2)}</td>
                                    <td>${t.pnl_pct > 0 ? '+' : ''}${t.pnl_pct.toFixed(3)}%</td>
                                    <td class="${t.result.toLowerCase()}">${t.result}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="last-update">
                    Ultimo aggiornamento: ${new Date(data.last_update).toLocaleString('it-IT')}
                </div>
            `;
            
            document.getElementById('content').innerHTML = html;
            
            // Grafico Equity
            const equityCtx = document.getElementById('equityCanvas')?.getContext('2d');
            if (equityCtx) {
                if (equityChart) equityChart.destroy();
                equityChart = new Chart(equityCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: data.equity_curve.length}, (_, i) => i),
                        datasets: [{
                            label: 'Equity',
                            data: data.equity_curve,
                            borderColor: '#00ff00',
                            backgroundColor: 'rgba(0, 255, 0, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: true, labels: { color: '#aaa' } } },
                        scales: {
                            y: { ticks: { color: '#aaa' }, grid: { color: 'rgba(0,212,255,0.1)' } },
                            x: { ticks: { color: '#aaa' }, grid: { color: 'rgba(0,212,255,0.1)' } }
                        }
                    }
                });
            }
            
            // Grafico Drawdown
            const drawdownCtx = document.getElementById('drawdownCanvas')?.getContext('2d');
            if (drawdownCtx) {
                if (drawdownChart) drawdownChart.destroy();
                drawdownChart = new Chart(drawdownCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: data.drawdown_curve.length}, (_, i) => i),
                        datasets: [{
                            label: 'Drawdown %',
                            data: data.drawdown_curve,
                            borderColor: '#ff3333',
                            backgroundColor: 'rgba(255, 51, 51, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: true, labels: { color: '#aaa' } } },
                        scales: {
                            y: { ticks: { color: '#aaa' }, grid: { color: 'rgba(0,212,255,0.1)' } },
                            x: { ticks: { color: '#aaa' }, grid: { color: 'rgba(0,212,255,0.1)' } }
                        }
                    }
                });
            }
        }
        
        // Carica all'avvio
        loadDashboard();
        
        // Aggiorna ogni 30 minuti
        setInterval(loadDashboard, 1800000);
    </script>
</body>
</html>
