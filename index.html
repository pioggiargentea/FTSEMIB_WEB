
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>FTSEMIB â€” Modello Volumi + SPX â‰¥ 0%</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>ðŸ“Š FTSEMIB â€” Modello Volumi + SPX â‰¥ 0%</h1>
  <div id="chart"></div>
  <div id="signal" class="signal-box"></div>
  <div id="metrics" class="metrics-box"></div>

  <script>
    async function renderDashboard() {
      try {
        const [eqRes, sigRes] = await Promise.all([
          fetch('equity.json'),
          fetch('signals.json')
        ]);

        const equity = await eqRes.json();
        const sig = await sigRes.json();

        // === Grafico Equity (log) ===
        const trace = {
          x: equity.map(p => p.date),
          y: equity.map(p => p.equity),
          mode: 'lines',
          line: { color: '#00bfff', width: 2 },
          name: 'Equity'
        };

        const layout = {
          paper_bgcolor: '#000000',
          plot_bgcolor: '#000000',
          font: { color: '#ffffff' },
          xaxis: { title: 'Data' },
          yaxis: { title: 'Equity (log)', type: 'log' },
          margin: { l: 60, r: 20, t: 50, b: 50 },
          title: 'Equity Curve (base = 1, scala logaritmica)'
        };

        Plotly.newPlot('chart', [trace], layout, {responsive: true});

        // === Segnale ultimo giorno ===
        const sBox = document.getElementById('signal');
        if (sig.signal === "LONG") {
          sBox.innerHTML = `
            <h2>ðŸ”” Segnale overnight</h2>
            <div class="sig sig-long">âœ… LONG su prossima apertura</div>
            <div class="sig-date">Ultimo giorno elaborato: ${sig.ultima_data}</div>
          `;
        } else {
          sBox.innerHTML = `
            <h2>ðŸ”” Segnale overnight</h2>
            <div class="sig sig-none">â›” Nessun segnale operativo</div>
            <div class="sig-date">Ultimo giorno elaborato: ${sig.ultima_data}</div>
          `;
        }

        // === Metriche sintetiche ===
        const mBox = document.getElementById('metrics');
        mBox.innerHTML = `
          <h3>Metriche sintetiche (storico)</h3>
          <div class="metrics-grid">
            <div><span>CAGR%</span><strong>${sig.cagr_%.toFixed(2)}</strong></div>
            <div><span>Max DD%</span><strong>${sig.max_dd_%.toFixed(2)}</strong></div>
            <div><span>Winrate%</span><strong>${sig.winrate_%.toFixed(2)}</strong></div>
            <div><span>Avg Trade%</span><strong>${sig.avg_trade_%.toFixed(4)}</strong></div>
            <div><span>Total Ret%</span><strong>${sig.total_ret_%.toFixed(2)}</strong></div>
            <div><span>N. Trades</span><strong>${sig.n_trades}</strong></div>
          </div>
          <p class="disclaimer">
            Sistema puramente quantitativo, basato su volumi di paniere e filtro SPX â‰¥ 0%.<br>
            Nessuna garanzia di profitto. Uso a solo scopo informativo.
          </p>
        `;
      } catch (err) {
        document.getElementById('signal').innerHTML =
          "<div class='sig sig-none'>Errore nel caricamento dei dati.</div>";
        console.error(err);
      }
    }

    renderDashboard();
  </script>
</body>
</html>
